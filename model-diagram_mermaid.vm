## -----------------------------------------------------------------------
## This template generates a database diagram 
## with the tables and their relationships
## -----------------------------------------------------------------------
---
title: $model.name - model diagram (generated by Telosys - $now.date $now.time)
---
erDiagram
## --- Macro for attribute documentation
#macro(attribdoc, $attrib)
#set($list = [])
#if ($attribute.isKeyElement()    )#set( $z = $list.add("ID") )#end
#if ($attribute.isFK()            )#set( $z = $list.add("FK") )#end
#if ($attribute.isNotNull()       )#set( $z = $list.add("NN") )#end
#if ($attribute.isUnique()        )#set( $z = $list.add("U")  )#end
#if ($attribute.isGeneratedValue())#set( $z = $list.add("G")  )#end
#set($r = $fn.join($list, " ") )#set($comment = $fn.join($list, " ") )
## For target language type you can use $attribute.type instead of $attribute.neutralType 
    ${attribute.name}#if($attribute.isKeyElement() )â¸±ðŸ†”#end  $attribute.neutralType  "$comment"
#end
## --- Macro for link documentation
#macro(linkdoc, $link)
## Mermaid doesn't support special characters in column 2
#if( $link.isCardinalityToMany() )#set($prefix="listâ¸±ofâ¸±")#else#set($prefix="")#end
    â†’â¸±$link.fieldName ${prefix}$link.targetEntityName "$link.cardinality"
#end
## --- Entities
#foreach( $entity in $selectedEntities )
  ${entity.name}#if($entity.isJoinEntity())â¸±â¸±ðŸ”—join-entity#end {
#foreach( $attribute in $entity.keyAttributes )
#attribdoc($attribute)
#end
#foreach( $attribute in $entity.nonKeyAttributes )
#attribdoc($attribute)
#end
#foreach( $link in $entity.links )
#linkdoc($link)
#end
  }
#end

## --- Links between entities (Model links != Database FK)
#foreach( $entity in $selectedEntities )
#foreach( $link in $entity.links )
#if ( $link.isCardinalityManyToOne() )
$entity.name }o--|| $link.targetEntity.name : ""
#elseif ( $link.isCardinalityOneToOne() )
$entity.name ||--|| $link.targetEntity.name : ""
#elseif ( $link.isCardinalityOneToMany() )
$entity.name ||--o{ $link.targetEntity.name : ""
#elseif ( $link.isCardinalityManyToMany() )
#if($link.hasJoinEntity())#set($comment = $link.joinEntityName)#else#set($comment = "")#end
$entity.name }o--o{ $link.targetEntityName : "$comment"
#end
#end
#end